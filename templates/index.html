<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Code Morpher</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-950 text-white flex h-screen overflow-hidden">

  <!-- Sidebar -->
  <div class="w-64 bg-gray-900 text-white flex flex-col p-4">
    <button id="new-chat-btn" class="mb-4 bg-green-600 hover:bg-green-700 p-2 rounded text-center font-semibold">
      + New Chat
    </button>
  </div>

  <!-- Main Chat Area -->
  <div class="flex-1 flex flex-col bg-gray-950">


    <!-- Input Area -->
    <div class="border-t border-gray-700 p-4 flex items-center space-x-2">
      <input
        id="user-input"
        type="text"
        placeholder="Type your message..."
        class="flex-1 p-3 rounded-lg border border-gray-700 bg-gray-800 text-white focus:outline-none focus:ring-2 focus:ring-blue-600"
      />
      <button
        id="send-button"
        class="p-3 bg-blue-600 hover:bg-blue-700 rounded-lg text-white text-lg"
      >
        ➤
      </button>
    </div>
  </div>

  <!-- JavaScript -->
  <script>
    const sendButton = document.getElementById("send-button");
    const userInput = document.getElementById("user-input");
    const chatBox = document.getElementById("chat-box");
    const newChatBtn = document.getElementById("new-chat-btn");

    // Start new chat
    newChatBtn.onclick = () => {
      userInput.value = "";
      chatBox.innerHTML = "";
    };

    // Function to send message
    async function sendMessage() {
      const prompt = userInput.value.trim();
      if (!prompt) return;

      // Add user message
      chatBox.innerHTML += `
        <div class="text-right"><strong>You:</strong> ${prompt}</div>
      `;
      userInput.value = "";
      chatBox.scrollTop = chatBox.scrollHeight;

      try {
        const response = await fetch("http://127.0.0.1:5000/api/generate", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ prompt }),
        });

        if (!response.ok) throw new Error("Network error");
        const data = await response.json();

        // Add bot response
        chatBox.innerHTML += `
          <div class="text-left"><strong>Bot:</strong> ${data.output}</div>
        `;
        chatBox.scrollTop = chatBox.scrollHeight;

      } catch (error) {
        chatBox.innerHTML += `
          <div class="text-red-500 text-left">❌ Failed to connect to backend.</div>
        `;
      }
    }

    // ✅ Make Enter key send message
    userInput.addEventListener("keydown", function (event) {
      if (event.key === "Enter" && !event.shiftKey) {
        event.preventDefault();
        sendMessage();
      }
    });

    // ✅ Make Send button work
    sendButton.addEventListener("click", sendMessage);
  </script>
</body>
</html>
